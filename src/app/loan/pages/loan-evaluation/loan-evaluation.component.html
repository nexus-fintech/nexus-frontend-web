<div class="page-container">

  <header class="page-header">
    <div class="header-content">
      <h1>Loan Evaluation & Risk Analysis</h1>
      <p>Search for clients and evaluate pending loan requests.</p>
    </div>
  </header>

  <mat-card class="search-section">
    <mat-card-content class="search-content">
      <mat-form-field appearance="outline" class="search-input">
        <mat-label>Search by Client ID</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput type="number" [(ngModel)]="clientIdToSearch" placeholder="E.g. 1">
      </mat-form-field>

      <button mat-flat-button color="primary" (click)="searchLoans()" class="search-btn">
        Search Loans
      </button>
    </mat-card-content>
  </mat-card>

  <div class="dashboard-grid">

    <mat-card class="list-card">
      <mat-card-header class="card-header">
        <mat-card-title>Loan Requests</mat-card-title>
        <mat-card-subtitle>Select a loan to evaluate</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="no-padding">
        <table mat-table [dataSource]="loans" class="full-width-table">

          <!-- ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let loan" class="cell-id"> #{{loan.id}} </td>
          </ng-container>

          <!-- Amount -->
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef> Amount </th>
            <td mat-cell *matCellDef="let loan" class="cell-amount"> ${{loan.requestedAmount}} </td>
          </ng-container>

          <!-- Rate -->
          <ng-container matColumnDef="rate">
            <th mat-header-cell *matHeaderCellDef> Rate </th>
            <td mat-cell *matCellDef="let loan"> {{loan.annualInterestRate * 100}}% </td>
          </ng-container>

          <!-- Term -->
          <ng-container matColumnDef="term">
            <th mat-header-cell *matHeaderCellDef> Term </th>
            <td mat-cell *matCellDef="let loan"> {{loan.termInMonths}}m </td>
          </ng-container>

          <!-- Status (Con Badges de Colores) -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let loan">
              <span class="status-badge" [ngClass]="loan.status.toLowerCase()">
                {{loan.status}}
              </span>
            </td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="align-right"> Action </th>
            <td mat-cell *matCellDef="let loan" class="align-right">
              @if (loan.status === 'REQUESTED') {
                <button mat-stroked-button color="accent" (click)="selectForApproval(loan)">
                  Evaluate
                </button>
              }
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>

          <!-- No Data -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell no-data-cell" colspan="6">
              <p>No loans found for this client.</p>
            </td>
          </tr>
        </table>
      </mat-card-content>
    </mat-card>

    <div class="evaluation-column">
      @if (selectedLoanId) {
        <div class="evaluation-wrapper">
          <div class="panel-header">
            <h3>Evaluating Loan #{{selectedLoanId}}</h3>
          </div>
          <app-loan-approval-form (approvalSubmitted)="onApprovalSubmit($event)"></app-loan-approval-form>
        </div>
      } @else {
        <div class="empty-state">
          <mat-icon>assignment_late</mat-icon>
          <p>Select a <strong>REQUESTED</strong> loan from the list to start the risk evaluation process.</p>
        </div>
      }
    </div>

  </div>
</div>
